# STM32 DHT11 + UART (HAL) Example

 Простой проект на STM32F103C8T6, демонстрирующий считывание температуры и влажности с датчика DHT11 с помощью «битбенгового» протокола и передачу полученных значений по UART.

## Платформа и инструменты

- **Микроконтроллер:** STM32F103C8T6 („Blue Pill“)  
- **IDE:** STM32CubeIDE (v1.x)  
- **Библиотеки:** STM32 HAL (STM32CubeMX-генерация)  
- **Отладка:** ST-Link V2  
- **Язык:** C (GCC)  

## Описание проекта

Этот проект выполняет следующие задачи:

1. **Инициализация UART1** на скорости **115200 бод** для вывода текстовых строк в терминал.  
2. **«Битбенговая» реализация обмена** с датчиком DHT11 (однопроводной протокол).  
   - Поддержка базового старта (LOW - 18 мс → HIGH - 30 мкс)  
   - Чтение 5 байт: целая/дробная части влажности, целая/дробная части температуры, контрольная сумма  
   - Валидация контрольной суммы  
3. **Вывод** значения температуры (°C) и влажности ( % ) в COM-порт каждые ~2 секунды.  

При ошибке (нет ответа или некорректная контрольная сумма) отправляется строка `“DHT11 Error!\r\n”`.

---
## Структура проекта
```
stm32-dht11-uart/
├── Core/                  
│   ├── Inc/               
│   │   ├── main.h         # Основной хедер (HAL, параметры)
│   │   ├── dht11.h        # Интерфейс DHT11-модуля
│   │   └── usart.h        # Функции отправки строк по UART
│   └── Src/               
│       ├── main.c         # Точка входа и основной цикл
│       ├── dht11.c        # Реализация DHT11-протокола (битбенг)
│       └── usart.c        # Реализация USART_SendString()
├── Drivers/               # Автогенерированные HAL-драйверы (CubeMX)
├── STM32CubeIDE/          # Конфигурация STM32CubeIDE и проектные файлы
├── .gitignore             # Исключения для Git
├── stm32-dht11-uart.ioc   # Файл конфигурации STM32CubeMX (CubeMX Project)
└── README.md              # Документация (этот файл)
```

## Подключение
```
Подключение выполнено по принципу «DHT11 → PB5, UART → PA9»:
            +3.3 V
              │
             [4.7 кΩ]  ← Подтягивающий резистор (рекомендуется)
              │
            DHT11 DATA ── PB5 (STM32)
              │
             DHT11 GND ── GND (STM32)
UART (однонаправленная передача):

PA9  (TX, STM32)  ── RX  (USB-UART CH340G)
GND  (STM32)       ── GND (USB-UART)

```
PB5 — вывод данных DHT11 (однопроводной шина).

PA9 — UART1 TX (передача данных в терминал).

PA10 (UART RX) не используется в данном примере.

GND всех устройств объединены.

Питание датчика DHT11 от 3.3 В STM32 (DHT11 умеет работать при 3.3 В).

Примечание: перед подключением убедитесь, что на линии DHT11 есть подтягивающий резистор (~4.7 кΩ или 10 кΩ).

## Конфигурация STM32CubeMX
1. Системный тактовый генератор (RCC)
  HSE = 8 MHz
  PLL ×9 → SYSCLK = 72 MHz

2. MX_USART1_UART_Init()
  Instance: USART1
  BaudRate: 115200
  Word Length: 8 Bits
  Stop Bits: 1 Bit
  Parity: None
  Mode: TX only (поскольку RX не используется)

3. MX_GPIO_Init()
  PA9 — AF Push-Pull (UART1 TX)
  PA10 — AF Input (UART1 RX) (однако RX не задействован)
  PB5 — GPIO Input/Output (будет перенастроен программно)
  Остальные пины оставлены по умолчанию (Analog / No Pull)

## Зависимости

 - STM32Cube HAL (генерируется вместе с проектом).

 - Нет сторонних библиотек (весь DHT11-протокол реализован вручную).

 - Функция HAL_Delay(ms) используется для задержки миллисекунд.

 - Для микросекундных задержек реализована своя функция Delay_us().

## Сборка и прошивка

1. Клонируйте репозиторий и откройте stm32-dht11-uart.ioc в STM32CubeIDE.

2. Нажмите “Generate Code” (если вы внесли изменения в CubeMX).

3. Соберите проект:
Build → Build Project   (Ctrl+Shift+B) 

4. Подключите ST-Link V2 и загрузите прошивку:
Run → Debug   (или Ctrl+F11) 
После успешной загрузки прошивки MCU перейдёт в режим исполнения.

5. Подключите USB-UART конвертер (CH340G) к PA9 (TX) и GND.

6. Запустите любой терминал (например, PuTTY, Tera Term или UART Assistant) с параметрами:
 - Скорость: 115200 бод
 - Формат: 8 датабит, Без четности, 1 стопбит (8N1)

7. При перезапуске STM32 в терминале начнут появляться строки:
" Temp: 23 C, Hum: 45 % "
" Temp: 24 C, Hum: 45 % "
При ошибке чтения DHT11 вы увидите:
" DHT11 Error! "

...
## Связанные проекты

- [STM32 ADC + UART (HAL)](https:github.com/Metabolisto/stm32_adc_uart_hal) 